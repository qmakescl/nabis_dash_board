# NABIS 균형발전지표 대시보드 개발 진행 현황 (2026-02-22)

## 목표

NABIS 균형발전지표 데이터를 기반으로 **시도·시군구별, 년도별 지리 대시보드**를 구축한다.

- 지도 위에 시군구 경계를 그리고, 지표값을 코로플레스 맵으로 시각화
- 사용자가 시도·시군구·지표·년도를 선택해 데이터를 탐색
- 전국 평균 대비 지자체 지표를 비교 분석

---

## 데이터 파이프라인 전체 구조

```
[NABIS 웹사이트]
      │  Selenium 자동 다운로드
      ▼
datasets/index2025-claude/{시도명}/{지역명}.xls   ← 원본 XLS (267개)
      │  build_dashboard_data.py
      ▼
datasets/processed/
  ├── indicators_long.csv       ← 56,325행 × 12열 long-format 데이터
  ├── indicator_catalog.json    ← 46개 지표 메타데이터
  └── region_hierarchy.json     ← 시도 17개 → 시군구 228개 계층

[V-World Shapefile]
      │  process_shapefile.py
      ▼
datasets/shapefile/SGG_2025/
  ├── sgg_20250630.json         ← 원본 해상도 GeoJSON (294 MB)
  └── smooth_sgg_2025.json      ← 경량화 GeoJSON (3.6 MB) ← 대시보드 사용 대상

      ↓  (미완료: 연계 매핑)
      ▼
[indicators_long.csv + smooth_sgg_2025.json 조인]
      │
      ▼
[대시보드 프론트엔드 / 백엔드]
```

---

## 완료된 작업

### Phase 1: 데이터 수집 (`download_nabis_index.py`)

| 항목 | 내용 |
|------|------|
| 방식 | Selenium + Chrome Headless + CDP `Browser.setDownloadBehavior` |
| 대상 | 시도 17개 + 시군구 약 250개 |
| 저장 경로 | `datasets/index2025-claude/{시도명}/{지역명}.xls` |
| 현황 | **완료** (267개 XLS 파일 수집됨) |

주요 해결 버그:
- `#jstree` → `#tree_menu` CSS 셀렉터 수정
- `except: continue` 제거로 시군구 전체 누락 방지
- jstree 자동 open 상태 판별 로직 개선

---

### Phase 2: 지표 데이터 빌드 (`build_dashboard_data.py`)

| 항목 | 내용 |
|------|------|
| 입력 | `datasets/index2025-claude/` 내 전체 XLS |
| 출력 | `datasets/processed/` 내 3종 파일 |
| 레코드 수 | 56,325행 (17시도 + 206시군구, 5개 발표년도, 46개 지표) |
| 현황 | **완료** |

생성 파일:
- **`indicators_long.csv`**: 핵심 데이터. 열 구성:
  - `sido, sigungu, region_type (시도/시군구)`
  - `publish_year (2021~2025)`
  - `indicator_no, indicator_type, category, indicator_name, unit`
  - `local_value, national_value, reference_year`
- **`indicator_catalog.json`**: 46개 지표 메타데이터 (순번·구분·부문·지표명·단위)
- **`region_hierarchy.json`**: 시도 → 시군구 계층 구조

데이터 품질:
- `local_value` 유효률: 2025(72.8%), 2024(69.8%), **2023(47.6%)**, 2022(69.2%), 2021(72.3%)
- 2023 결측 다수: NABIS 공표 주기 차이로 추정
- `sido='전국'` 패턴 처리: 시군구 수준 미제공 지표는 해당 행만 제외

---

### Phase 3: Shapefile 처리 (`process_shapefile.py`)

| 항목 | 내용 |
|------|------|
| 입력 | `datasets/shapefile/BND_SIGUNGU_PG/BND_SIGUNGU_PG.shp` (V-World, 97 MB) |
| 중간 | 센서스 공간정보 지역 코드.xlsx (시군구코드 → 시군구명 매핑) |
| 출력 | `datasets/shapefile/SGG_2025/smooth_sgg_2025.json` (3.6 MB) |
| 현황 | **완료** |

핵심 처리:
1. Shapefile DBF에서 `SIGUNGU_CD`(5자리) + `SIGUNGU_NM` 추출
2. 엑셀 코드 매핑으로 `시도명칭` + `TARGET_NM` 부여
3. **Dissolve**: `도` 산하 `시 소속 구` (예: 수원시 장안구 → 수원시)를 시 단위로 합침
4. **TopoJSON 단순화**: `toposimplify(tolerance=5000m)` → 294 MB → 3.6 MB

`smooth_sgg_2025.json` 속성:
- `SIDO_NM`: 시도명 (예: `서울특별시`)
- `SIGUNGU_NM`: 시군구명 (예: `종로구`, `수원시`)
- `SIGUNGU_CD`: 5자리 코드
- `geometry`: 경계 폴리곤

---

## 미완료 작업 (남은 단계)

### Step 1: 지역명 매핑 테이블 생성 ← **다음 작업**

`indicators_long.csv`의 `sigungu` 열과 `smooth_sgg_2025.json`의 `SIGUNGU_NM`을 연결하는 매핑 테이블이 필요하다.

- **이유**: 두 데이터 출처의 지역명이 다를 수 있음
  - 예: NABIS의 `창원시` ↔ Shapefile의 `창원시` (단순 일치)
  - 예: NABIS의 `수원시 장안구` 행은 없고 `수원시`만 있음 (Dissolve로 이미 합쳐짐)
- **작업**: 불일치 목록 추출 → 수동 또는 규칙 기반 보정 테이블 생성
- **결과물**: `datasets/processed/region_name_map.json`

### Step 2: 통합 데이터셋 생성

위 매핑을 적용해 `indicators_long.csv` ↔ `smooth_sgg_2025.json` 조인 키를 확정하고, 대시보드에서 바로 사용할 수 있는 형태로 정리한다.

- `indicators_long.csv`에 `SIGUNGU_CD` 열 추가 (지도 조인 키)
- 또는 대시보드 런타임에서 동적 조인 허용 (구현 방식에 따라 결정)

### Step 3: 대시보드 구현

기술 스택 미결정. 선택지:

| 방식 | 특징 |
|------|------|
| **Plotly Dash (Python)** | 빠른 프로토타이핑, Python 생태계 유지 |
| **Streamlit** | 더 간단한 코드, 레이아웃 자유도 낮음 |
| **React + D3.js / Leaflet** | 완전 커스텀, 구현 비용 높음 |
| **Observable / Vega-Lite** | 선언형 시각화, 러닝커브 있음 |

최소 기능(MVP):
- [ ] 시도/시군구 선택 (드롭다운 또는 지도 클릭)
- [ ] 지표 선택 (46개)
- [ ] 발표년도 선택 (2021~2025)
- [ ] 코로플레스 지도 (시군구별 지표값 색상)
- [ ] 선택 지역의 지표값 vs 전국 평균 비교 표시

추가 기능(이후 단계):
- [ ] 시계열 추이 차트 (년도별 변화)
- [ ] 복수 지표 비교
- [ ] 랭킹 테이블

---

## 파일 현황 요약

### 완성된 파일

| 파일 | 크기 | 설명 |
|------|------|------|
| `datasets/processed/indicators_long.csv` | 6.8 MB | 핵심 지표 데이터 |
| `datasets/processed/indicator_catalog.json` | 8 KB | 지표 메타데이터 |
| `datasets/processed/region_hierarchy.json` | 4 KB | 지역 계층 구조 |
| `datasets/shapefile/SGG_2025/smooth_sgg_2025.json` | 3.6 MB | 경량화 시군구 경계 |
| `datasets/shapefile/SGG_2025/sgg_20250630.json` | 294 MB | 원본 해상도 (보관용) |

### 스크립트

| 파일 | 역할 | 상태 |
|------|------|------|
| `download_nabis_index.py` | NABIS XLS 자동 다운로드 | 완료 |
| `build_dashboard_data.py` | XLS → 처리 파일 생성 | 완료 |
| `process_shapefile.py` | Shapefile → GeoJSON 경량화 | 완료 |
| `analyze_dataset.py` | 데이터 탐색용 (임시) | 참조용 |

### 원본 데이터

| 경로 | 설명 |
|------|------|
| `datasets/index2025-claude/` | 원본 XLS 267개 (시도 17 + 시군구 ~250) |
| `datasets/shapefile/BND_SIGUNGU_PG/` | V-World 시군구 경계 원본 (97 MB) |
| `datasets/shapefile/센서스 공간정보 지역 코드.xlsx` | 시군구 코드-명칭 매핑 엑셀 |

---

## 즉시 착수 가능한 다음 작업

1. **지역명 불일치 확인**: `indicators_long.csv`의 `sigungu` 유니크 목록과 `smooth_sgg_2025.json`의 `SIGUNGU_NM` 유니크 목록을 비교해 불일치 항목 파악
2. **대시보드 기술 스택 결정**: Plotly Dash vs Streamlit vs 웹
3. **MVP 구현 착수**: 지도 + 지표 선택 + 코로플레스 시각화
